{% extends "base.html" %}
{% load static %}

{% block content %}
<style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: 'Poppins', sans-serif;
    }

    body {
        min-height: 100vh;
        background: linear-gradient(135deg, #b2f7ef, #d6fff6, #fff9c4);
        display: flex;
        justify-content: center;
        padding: 20px;
    }

    body::before {
        content: "";
        position: fixed;
        inset: 0;
        background: url("logo.png") center/260px no-repeat;
        opacity: 0.05;
        pointer-events: none;
    }

    .container {
        width: 100%;
        max-width: 480px;
        background: rgba(255, 255, 255, 0.9);
        border-radius: 22px;
        padding: 22px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
        animation: fadeUp .7s ease;
    }

    @keyframes fadeUp {
        from { opacity: 0; transform: translateY(25px) }
        to { opacity: 1; transform: translateY(0) }
    }

    h2 {
        text-align: center;
        color: #006d77;
        margin-bottom: 10px;
    }

    label {
        font-size: .85rem;
        font-weight: 600;
        color: #333;
    }

    input, select {
        width: 100%;
        margin-top: 6px;
        padding: 12px;
        border-radius: 12px;
        border: 1px solid #ccc;
        font-size: .9rem;
    }

    input:focus, select:focus {
        border-color: #00b4d8;
        outline: none;
    }

    .form-group {
        margin-top: 14px;
    }

    .gstin-status {
        font-size: .75rem;
        margin-top: 4px;
        font-weight: 600;
    }

    .valid { color: green }
    .invalid { color: red }

    .toggle {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-top: 10px;
    }

    .days {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        margin-top: 8px;
    }

    .days label {
        background: #e0f7fa;
        padding: 6px 10px;
        border-radius: 999px;
        font-size: .75rem;
        cursor: pointer;
    }

    button {
        width: 100%;
        margin-top: 18px;
        padding: 14px;
        border: none;
        border-radius: 14px;
        background: linear-gradient(135deg, #00b4d8, #0077b6);
        color: white;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
    }
</style>

<div class="container">

    <h2>Register Your Business</h2>

    <form method="POST">
        {% csrf_token %}

        <!-- BUSINESS NAME -->
        <div class="form-group">
            <label>Business Name</label>
            <input name="business_name" required>
        </div>

        <!-- CATEGORY -->
        <div class="form-group">
            <label>Category</label>
            <select name="category" required>
                <option value="">Select Category</option>
                <option value="pg">PG / Hostel</option>
                <option value="mess">Mess / Tiffin</option>
                <option value="medical">Medical Store</option>
                <option value="stationery">Stationery</option>
            </select>
        </div>

        <!-- GSTIN -->
        <div class="form-group">
            <label>GSTIN</label>
            <input name="gstin" maxlength="15" required oninput="validateGST()">
            <div id="gstStatus" class="gstin-status"></div>
        </div>

        <!-- OPEN / CLOSE TIME -->
        <div class="form-group">
            <label>Opening Time</label>
            <input type="time" name="open_time" id="openTime">
        </div>

        <div class="form-group">
            <label>Closing Time</label>
            <input type="time" name="close_time" id="closeTime">
        </div>

        <!-- 24 HOURS -->
        <div class="toggle">
            <input type="checkbox" name="open_24_hours" id="allDay" onchange="toggle24()">
            <label>Open 24 Hours</label>
        </div>

        <!-- WORKING DAYS -->
        <div class="form-group">
            <label>Working Days</label>
            <div class="days">
                <label><input type="checkbox" name="working_days" value="Mon"> Mon</label>
                <label><input type="checkbox" name="working_days" value="Tue"> Tue</label>
                <label><input type="checkbox" name="working_days" value="Wed"> Wed</label>
                <label><input type="checkbox" name="working_days" value="Thu"> Thu</label>
                <label><input type="checkbox" name="working_days" value="Fri"> Fri</label>
                <label><input type="checkbox" name="working_days" value="Sat"> Sat</label>
                <label><input type="checkbox" name="working_days" value="Sun"> Sun</label>
            </div>
        </div>

        <!-- LOCATION -->
        <input type="hidden" name="latitude" id="lat">
        <input type="hidden" name="longitude" id="lng">

        <button type="submit">Submit for Approval</button>
    </form>

</div>

<script>
function validateGST(){
    const gst=document.querySelector('[name="gstin"]').value.toUpperCase();
    const regex=/^[0-9]{2}[A-Z]{5}[0-9]{4}[A-Z]{1}[1-9A-Z]{1}Z[0-9A-Z]{1}$/;
    const status=document.getElementById("gstStatus");
    if(!gst){status.innerHTML="";return;}
    if(regex.test(gst)){
        status.innerHTML="✔ Valid GSTIN";
        status.className="gstin-status valid";
    }else{
        status.innerHTML="✖ Invalid GSTIN";
        status.className="gstin-status invalid";
    }
}

function toggle24(){
    const checked=document.getElementById("allDay").checked;
    document.getElementById("openTime").disabled=checked;
    document.getElementById("closeTime").disabled=checked;
}

navigator.geolocation.getCurrentPosition(pos=>{
    document.getElementById("lat").value = pos.coords.latitude;
    document.getElementById("lng").value = pos.coords.longitude;
});
</script>

{% endblock %}
