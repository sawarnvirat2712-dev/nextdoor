{% extends "base.html" %}
{% load static %}

{% block content %}

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">

<style>
/* ---- SAME CSS AS YOURS (UNCHANGED) ---- */
*{
    margin:0;
    padding:0;
    box-sizing:border-box;
    font-family:'Poppins',sans-serif;
}

body{
    min-height:100vh;
    background-image:url("{% static 'assets/bg.jpg' %}");
    background-size:cover;
    background-position:center;
    padding:20px;
}

.place-wrapper{
    min-height:100vh;
    display:flex;
    align-items:center;
    justify-content:center;
}

.place-card{
    width:100%;
    max-width:560px;
    background:rgba(255,255,255,.18);
    backdrop-filter:blur(18px);
    border-radius:26px;
    padding:26px;
    border:1px solid rgba(255,255,255,.35);
    box-shadow:0 30px 60px rgba(0,0,0,.35);
    animation:fadeUp .6s ease;
}

@keyframes fadeUp{
    from{opacity:0;transform:translateY(25px)}
    to{opacity:1;transform:translateY(0)}
}

.place-card h2{
    color:#5eead4;
    font-weight:700;
}

.badges{
    display:flex;
    gap:8px;
    margin-bottom:14px;
}

.badge{
    font-size:.7rem;
    padding:5px 12px;
    border-radius:999px;
    font-weight:600;
}

.verified{background:#22c55e;color:#fff}
.open{background:#38bdf8;color:#fff}
.closed{background:#ef4444;color:#fff}
.closing{background:#f59e0b;color:#fff}

.info p{
    font-size:.9rem;
    color:rgba(255,255,255,.85);
    margin-top:6px;
}

iframe{
    width:100%;
    height:240px;
    border-radius:16px;
    border:none;
    margin:18px 0;
}

.map-btn{
    display:block;
    padding:14px;
    border-radius:14px;
    background:linear-gradient(135deg,#38bdf8,#0ea5e9);
    color:#fff;
    text-align:center;
    text-decoration:none;
    font-weight:600;
    margin-bottom:14px;
}

.stars{
    display:flex;
    gap:6px;
    font-size:1.6rem;
    cursor:pointer;
}

.stars span{color:#334155}
.stars span.active{color:#facc15}

.rating-info{
    font-size:.8rem;
    color:rgba(255,255,255,.75);
    margin-top:4px;
}

button{
    width:100%;
    margin-top:14px;
    padding:14px;
    border:none;
    border-radius:14px;
    background:linear-gradient(135deg,#22c55e,#16a34a);
    color:white;
    font-weight:600;
    cursor:pointer;
}
</style>

<div class="place-wrapper">

<div class="place-card">

<h2>{{ place.name }}</h2>

<div class="badges">
    <span class="badge verified">‚úî Verified</span>
    <span class="badge {{ status }}">{{ status|title }}</span>
</div>

<div class="info">
    <p><strong>üìç Address:</strong> {{ place.address }}</p>
    <p><strong>‚è∞ Timings:</strong>
        {% if place.open_24_hours %}
            Open 24 Hours
        {% else %}
            {{ place.open_time }} ‚Äì {{ place.close_time }}
        {% endif %}
    </p>
    <p><strong>üìÜ Working Days:</strong> {{ place.working_days|join:", " }}</p>
    <p><strong>üìû Phone:</strong> {{ place.phone }}</p>
</div>

<iframe src="https://www.google.com/maps?q={{ place.latitude }},{{ place.longitude }}&z=15&output=embed"></iframe>

<a class="map-btn"
   href="https://www.google.com/maps/dir/?api=1&destination={{ place.latitude }},{{ place.longitude }}"
   target="_blank">
   üó∫Ô∏è Open in Google Maps
</a>

<div class="rating">
    <div class="stars" id="stars">
        <span data-value="1">‚òÖ</span>
        <span data-value="2">‚òÖ</span>
        <span data-value="3">‚òÖ</span>
        <span data-value="4">‚òÖ</span>
        <span data-value="5">‚òÖ</span>
    </div>
    <div class="rating-info">
        ‚≠ê {{ avg_rating }} / 5 ({{ total_ratings }} reviews)
    </div>
</div>

{% if user.is_authenticated %}
    {% if user_has_rated %}
        <p style="margin-top:12px;color:#facc15;font-weight:600;">
            ‚≠ê You already rated this place
        </p>
    {% else %}
        <form method="POST" action="{% url 'submit_rating' place.id %}">
            {% csrf_token %}
            <input type="hidden" name="rating" id="ratingValue">
            <button type="submit">Submit Rating</button>
        </form>
    {% endif %}
{% else %}
    <p style="margin-top:12px;color:#f87171;font-weight:600;">
        Login to submit a rating
    </p>
{% endif %}

</div>
</div>

<script>
const stars=document.querySelectorAll("#stars span");
const ratingInput=document.getElementById("ratingValue");

stars.forEach(star=>{
    star.addEventListener("click",()=>{
        const value=star.dataset.value;
        ratingInput.value=value;
        stars.forEach(s=>{
            s.classList.toggle("active",s.dataset.value<=value);
        });
    });
});
</script>

{% endblock %}
