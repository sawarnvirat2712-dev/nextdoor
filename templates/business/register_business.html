{% extends "base.html" %}
{% load static %}

{% block content %}

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">

<style>
*{
    margin:0;
    padding:0;
    box-sizing:border-box;
    font-family:'Poppins',sans-serif;
}

/* ===== PAGE BACKGROUND ===== */
body{
    min-height:100vh;
    background-image:url("{% static 'assets/bg.jpg' %}");
    background-size:cover;
    background-position:center;
    background-repeat:no-repeat;
    padding:20px;
}

/* ===== CENTER WRAPPER ===== */
.page-wrapper{
    min-height:100vh;
    display:flex;
    align-items:center;
    justify-content:center;
}

/* ===== GLASS CARD ===== */
.form-card{
    width:100%;
    max-width:520px;
    background:rgba(0,0,0,0.45);
    backdrop-filter:blur(18px);
    border-radius:24px;
    padding:30px;
    box-shadow:0 30px 60px rgba(0,0,0,.4);
    border:1px solid rgba(255,255,255,.25);
    animation:fadeUp .7s ease;
}

@keyframes fadeUp{
    from{opacity:0;transform:translateY(25px)}
    to{opacity:1;transform:translateY(0)}
}

/* ===== HEADINGS ===== */
h2{
    text-align:center;
    color:#5eead4;
    font-size:1.8rem;
    margin-bottom:6px;
}

.subtitle{
    text-align:center;
    font-size:.85rem;
    color:rgba(255,255,255,.75);
    margin-bottom:22px;
}

/* ===== FORM ===== */
.form-group{margin-top:14px}

label{
    font-size:.8rem;
    font-weight:600;
    color:rgba(255,255,255,.85);
}

input, select, textarea{
    width:100%;
    margin-top:6px;
    padding:13px;
    border-radius:14px;
    border:1px solid rgba(255,255,255,.25);
    background:rgba(255,255,255,.92);
    font-size:.85rem;
}

textarea{resize:none}

input:focus, select:focus, textarea:focus{
    outline:none;
    box-shadow:0 0 0 3px rgba(94,234,212,.45);
}

/* ===== GST STATUS ===== */
.gstin-status{
    font-size:.75rem;
    margin-top:4px;
    font-weight:600;
}
.valid{color:#2ecc71}
.invalid{color:#e74c3c}

/* ===== DAYS ===== */
.days{
    display:flex;
    flex-wrap:wrap;
    gap:8px;
    margin-top:8px;
}

.days label{
    background:rgba(255,255,255,.9);
    padding:6px 12px;
    border-radius:999px;
    font-size:.7rem;
    cursor:pointer;
}

/* ===== TOGGLE ===== */
.toggle{
    display:flex;
    align-items:center;
    gap:8px;
    margin-top:12px;
    color:#fff;
    font-size:.8rem;
}

/* ===== BUTTONS ===== */
button{
    width:100%;
    margin-top:16px;
    padding:14px;
    border:none;
    border-radius:16px;
    background:linear-gradient(135deg,#00b4d8,#0077b6);
    color:white;
    font-weight:600;
    cursor:pointer;
    transition:.3s;
}

button:hover{
    transform:translateY(-2px);
    box-shadow:0 10px 25px rgba(0,180,216,.45);
}

.secondary{
    background:linear-gradient(135deg,#6c757d,#495057);
}

.note{
    font-size:.7rem;
    color:rgba(255,255,255,.7);
    margin-top:6px;
    text-align:center;
}
</style>

<div class="page-wrapper">
<div class="form-card">

    <h2>Register Your Business</h2>
    <div class="subtitle">Get discovered by people near you</div>

    <form method="POST" onsubmit="return validateForm()">
        {% csrf_token %}

        <div class="form-group">
            <label>Business Name</label>
            <input name="business_name" required>
        </div>

        <div class="form-group">
            <label>Category</label>
            <select name="category" required>
                <option value="">Select Category</option>
                <option value="pg">PG / Hostel</option>
                <option value="mess">Mess / Tiffin</option>
                <option value="medical">Medical Store</option>
                <option value="stationery">Stationery</option>
            </select>
        </div>

        <div class="form-group">
            <label>GSTIN</label>
            <input name="gstin" id="gstin" maxlength="15" oninput="validateGST(this)">
            <div id="gstStatus" class="gstin-status"></div>
        </div>

        <div class="form-group">
            <label>Working Days</label>
            <div class="days">
                <label><input type="checkbox" name="working_days" value="Mon"> Mon</label>
                <label><input type="checkbox" name="working_days" value="Tue"> Tue</label>
                <label><input type="checkbox" name="working_days" value="Wed"> Wed</label>
                <label><input type="checkbox" name="working_days" value="Thu"> Thu</label>
                <label><input type="checkbox" name="working_days" value="Fri"> Fri</label>
                <label><input type="checkbox" name="working_days" value="Sat"> Sat</label>
                <label><input type="checkbox" name="working_days" value="Sun"> Sun</label>
            </div>
        </div>

        <div class="form-group">
            <label>Opening Time</label>
            <input type="time" name="open_time" id="openTime">
        </div>

        <div class="form-group">
            <label>Closing Time</label>
            <input type="time" name="close_time" id="closeTime">
        </div>

        <div class="toggle">
            <input type="checkbox" id="allDay" name="open_24_hours" onchange="toggle24(this)">
            <label>Open 24 Hours</label>
        </div>

        <div class="form-group">
            <label>Business Address</label>
            <textarea name="address" id="address"></textarea>
        </div>

        <div class="form-group">
            <label>Phone Number</label>
            <input name="phone" type="tel" pattern="[0-9]{10}" required>
        </div>

        <div class="form-group">
            <label>Latitude</label>
            <input name="latitude" id="lat">
        </div>

        <div class="form-group">
            <label>Longitude</label>
            <input name="longitude" id="lng">
        </div>

        <div class="note">Address auto-detects when latitude & longitude are available</div>

        <button type="button" class="secondary" onclick="detectLocation()">üìç Auto Detect Location</button>
        <button type="submit">Submit for Approval</button>
    </form>

</div>
</div>

<script>
let gstValid=false;
const latInput=document.getElementById("lat");
const lngInput=document.getElementById("lng");

function validateGST(el){
    const regex=/^[0-9]{2}[A-Z]{5}[0-9]{4}[A-Z][1-9A-Z]Z[0-9A-Z]$/;
    const status=document.getElementById("gstStatus");
    if(!el.value){status.innerHTML="";gstValid=false;return;}
    if(regex.test(el.value.toUpperCase())){
        status.innerHTML="‚úî Valid GSTIN";
        status.className="gstin-status valid";
        gstValid=true;
    }else{
        status.innerHTML="‚úñ Invalid GSTIN";
        status.className="gstin-status invalid";
        gstValid=false;
    }
}

function toggle24(el){
    openTime.disabled=el.checked;
    closeTime.disabled=el.checked;
}

function detectLocation(){
    navigator.geolocation.getCurrentPosition(pos=>{
        latInput.value=pos.coords.latitude.toFixed(6);
        lngInput.value=pos.coords.longitude.toFixed(6);
        fetchAddress();
    });
}

latInput.addEventListener("input", fetchAddress);
lngInput.addEventListener("input", fetchAddress);

function fetchAddress(){
    if(latInput.value && lngInput.value){
        fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${latInput.value}&lon=${lngInput.value}`)
        .then(res=>res.json())
        .then(data=>{
            if(data.display_name){
                document.getElementById("address").value=data.display_name;
            }
        });
    }
}

function validateForm(){
    if(!gstValid){
        alert("Enter a valid GSTIN");
        return false;
    }
    return true;
}
</script>

{% endblock %}
